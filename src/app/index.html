<!DOCTYPE HTML>
<html>
<head>
 <meta charset="UTF-8">
 <title>Title</title>
 <script src="vendor/jquery/dist/jquery.js"></script>
 <script src="vendor/underscore/underscore.js"></script>
 <script src="vendor/backbone/backbone.js"></script>
 <script src="vendor/bootstrap/dist/js/bootstrap.js"></script>
 <script src="vendor/requirejs/require.js"></script>
 <link rel="stylesheet" href="vendor/bootstrap/dist/css/bootstrap.css">
 <link rel="stylesheet" href="css/simple-sidebar/simple-sidebar.css" >
 <style type="text/css">
    body {
        padding: 50px 100px 50px 50px;
        background-image: url("img/background_green.jpg");
        background-attachment: fixed;
    }

    body.modal-open .blurred-background {
    -webkit-filter: blur(4px);
    -moz-filter: blur(4px);
    -o-filter: blur(4px);
    -ms-filter: blur(4px);
    filter: blur(4px);
    }

    .sidebar-nav-divider {
      display: block;
      text-decoration: none;
      background-color: transparent;
      color: transparent;
      background: transparent;
      height: 20px;

    }

     .col-sm-3 {
         /* border: 1px solid; */
         height: 220px;
     }

     .poster {
         box-shadow: 10px 10px 5px black;
     }

     .poster:active {
         margin-top: 10px;
         margin-left: 10px;
         /* height: 160px;
         width: 106px; */
         box-shadow: 0px 0px 0px black;
     }

 </style>
<script>

//Configuration for requireJS. Should we move it to another file.. shall we?
requirejs.config({
    paths: {
      "text": "vendor/text/text"
  },
});

</script>
<script>
 // Backbone integration
 var MovieDetails = Backbone.Model.extend({
   initialize: function() {
     console.log("MovieDetails initialize");
     this.on("change", function() {
         console.log("Changed attributes: " + JSON.stringify(this.changedAttributes()));
     });
   },
 });

 var movieDetails = new MovieDetails();

</script>
<script type="text/javascript" src="EditMovieModal.js"></script>
</head>
<body>

<div id="wrapper" class="blurred-background">
            <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li>
                  <a href="#">Search</a>
                </li>
                <li class="sidebar-nav-divider"></li>
                <li>
                    <a href="#">Movies</a>
                </li>
                <li>
                    <a href="#">TvShow</a>
                </li>
                <li class="sidebar-nav-divider"></li>
                <li>
                    <a href="#">Settings</a>
                </li>
            </ul>
        </div>
        <!-- /#sidebar-wrapper -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                            <div id="movielist">
                            </div>
                    </div>
                </div>
            </div>
    </div>
</div>
<script>

function writeMovieList(movieListJSON) {

    var i=1;
    var strHTML="";
    var thumbURI;
    //strHTML = "Total movies:" + movieListJSON.result.limits.total + "<br/>";
    var movieListDetails = movieListJSON.result.movies;
    $.each(movieListDetails, function(idMovie, movieDetails) {
        if (i == 1) {strHTML += '<div class="row">'};
        strHTML += '<div class="col-sm-3 col-md-3">';
        thumbURI = decodeURIComponent(movieDetails.thumbnail.substring(8,movieDetails.thumbnail.length-1));
        if (!(thumbURI.startsWith("http"))) {thumbURI = serverKodi + "vfs/" + thumbURI};
        strHTML += '<img class="poster" data-toggle="modal" data-target="#EditMovieModal" data-movieid="' + movieDetails.movieid + '" data-movietitle="' +  movieDetails.label + '" Title src="' + thumbURI + '" width="126px" height="180px"></div>'
        i++;
        if (i==5) {
          strHTML += '</div>';
          i = 1;
        };
    });

    document.getElementById('movielist').innerHTML = strHTML;

}

// Code to fecth JSON from server - Disabled for development / testing
    var serverKodi = "http://10.222.224.157:8890/";
//    var serverKodi = "http://192.168.0.203/";
    var urlJsonRPC = "jsonrpc?request=";
    var stringJsonGetMoviesList = '{"jsonrpc": "2.0", "method": "VideoLibrary.GetMovies", "params": { "filter": {"field": "playcount", "operator": "is", "value": "0"}, "limits": { "start" : 0, "end": 25 }, "properties" : ["art", "rating", "thumbnail", "playcount", "file"], "sort": { "order": "ascending", "method": "label", "ignorearticle": true } }, "id": "libMovies"}';

// Settings for development
/*  var serverKodi = "../../test_files/";
    var urlJsonRPC = "";
    var stringJson = "videolibrary.getmovies_resp.json";
*/

    var urlKodi = serverKodi + urlJsonRPC + stringJsonGetMoviesList;

    $.getJSON(urlKodi, jQuery.noop)
    .error(function() { alert("Error reading JSON"); })
    .success(function(data) {
       writeMovieList(data);
    });

</script>
</body>
</html>
